___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Matomo Analytics - Configuration",
  "categories": [
    "ANALYTICS",
    "TAG_MANAGEMENT"
  ],
  "brand": {
    "id": "github.com_data-marketing-school",
    "displayName": "data-marketing-school",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Matomo Analytics configuration tag template.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "setupType",
    "displayName": "Setup Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "clientSide",
        "displayValue": "Client-Side"
      },
      {
        "value": "serverSide",
        "displayValue": "Server-Side"
      }
    ],
    "simpleValueType": true,
    "help": "Client-Side: Documentation coming soon...\u003cbr\u003e Server-Side: Follow \u003ca href\u003d\"https://data-marketing-school.com/en/blog/google-tag-manager/matomo-server-side/\"\u003ethis guide\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "matomoBaseUrl",
    "displayName": "Matomo Instance URL",
    "simpleValueType": true,
    "help": "This is the URL of your Matomo instance. (e.g. https://srv.matomo.cloud or https://srv.example.com).",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "REGEX",
        "args": [
          "https://.*"
        ]
      }
    ],
    "valueHint": "https://srv.matomo.cloud",
    "notSetText": "This field is required.",
    "alwaysInSummary": true,
    "enablingConditions": [
      {
        "paramName": "setupType",
        "paramValue": "clientSide",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "matomoSiteId",
    "displayName": "Matomo Site ID",
    "simpleValueType": true,
    "help": "The ID of your website in Matomo.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "NUMBER"
      }
    ],
    "valueHint": "1",
    "notSetText": "This field is required.",
    "alwaysInSummary": true,
    "enablingConditions": [
      {
        "paramName": "setupType",
        "paramValue": "clientSide",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "customDimensions",
    "displayName": "Custom Dimensions (Visit)",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "PARAM_TABLE",
        "name": "customDimensionsArray",
        "displayName": "The ID must match the custom dimension ID set up in your Matomo instance.",
        "paramTableColumns": [
          {
            "param": {
              "type": "TEXT",
              "name": "customDimensionId",
              "displayName": "Custom Dimension ID",
              "simpleValueType": true,
              "valueValidators": [
                {
                  "type": "POSITIVE_NUMBER"
                }
              ]
            },
            "isUnique": true
          },
          {
            "param": {
              "type": "TEXT",
              "name": "customDimensionValue",
              "displayName": "Custom Dimension Value",
              "simpleValueType": true
            },
            "isUnique": false
          }
        ],
        "alwaysInSummary": false,
        "help": "Go to Settings \u003e Websites \u003e Custom Dimensions \u003e Visit Dimensions \u003e Create a New Dimension",
        "newRowButtonText": "New Custom Dimension",
        "newRowTitle": "New Custom Dimension",
        "editRowTitle": "Edit Custom Dimension"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "userIdSection",
    "displayName": "User ID",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "userId",
        "displayName": "User ID",
        "simpleValueType": true,
        "defaultValue": "",
        "canBeEmptyString": true,
        "valueHint": "123456",
        "help": "Use a unique and persistent identifier."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "crossDomainLinking",
    "displayName": "Cross-Domain Linking",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "enableCrossDomainTracking",
        "checkboxText": "Enable Cross-Domain Linking",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "SIMPLE_TABLE",
            "name": "domainNames",
            "displayName": "Set  domains and/or sub-domains",
            "simpleTableColumns": [
              {
                "defaultValue": "",
                "displayName": "Domain names",
                "name": "domain_name",
                "type": "TEXT"
              }
            ],
            "enablingConditions": [
              {
                "paramName": "enableCrossDomainTracking",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "newRowButtonText": "New Domain"
          }
        ]
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "contentSettingsSection",
    "displayName": "Content Tracking Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "RADIO",
        "name": "contentSettings",
        "displayName": "",
        "radioItems": [
          {
            "value": "trackAllContentImpressions",
            "displayValue": "Track all content impressions",
            "help": "Will scan the entire DOM for content blocks and track a content impression immediately for each of them."
          },
          {
            "value": "trackVisibleContentImpressions",
            "displayValue": "Track visible content impressions",
            "subParams": [
              {
                "type": "TEXT",
                "name": "timeInterval",
                "displayName": "Time interval (Optional)",
                "simpleValueType": true,
                "valueUnit": "milliseconds",
                "valueValidators": [
                  {
                    "type": "POSITIVE_NUMBER"
                  }
                ],
                "help": "Rescan the entire DOM for new content impressions every X milliseconds. Default is 750 ms.",
                "defaultValue": 750,
                "canBeEmptyString": true
              },
              {
                "type": "CHECKBOX",
                "name": "disableCheckOnScroll",
                "checkboxText": "Disable check on scroll (Optional)",
                "simpleValueType": true,
                "help": "Won\u0027t rescan the DOM after each scroll."
              }
            ],
            "help": "Will only track content blocks in the viewport and not hidden (opacity, visibility, display)."
          },
          {
            "value": "not_set",
            "displayValue": "Not set",
            "help": "Won\u0027t track any content blocks."
          }
        ],
        "simpleValueType": true,
        "defaultValue": "not_set"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "ecommerceSettingsSection",
    "displayName": "E-commerce Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "delayPageView",
        "checkboxText": "Delay Page View",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "delayTime",
        "displayName": "Delay (in ms)",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "delayPageView",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "valueHint": "2000",
        "defaultValue": 2000
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "otherSection",
    "displayName": "Other Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "overrideDocumentTitle",
        "checkboxText": "Override document title",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "newDocumentTitle",
            "displayName": "New document title",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "overrideDocumentTitle",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "defaultValue": false,
        "help": "Overrides the document title to track."
      },
      {
        "type": "CHECKBOX",
        "name": "overridePageUrl",
        "checkboxText": "Override page URL",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "newPageUrl",
            "displayName": "New page URL",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "overridePageUrl",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "defaultValue": false,
        "help": "Overrides the page URL to track."
      },
      {
        "type": "CHECKBOX",
        "name": "overridePageReferrer",
        "checkboxText": "Override page Referrer",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "newPageReferrer",
            "displayName": "New page Referrer",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "overridePageReferrer",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "defaultValue": false,
        "help": "Overrides the page Referrer to track. Useful for Single Page Applications."
      },
      {
        "type": "CHECKBOX",
        "name": "enableHeartbeatTimer",
        "checkboxText": "Enable heartbeat timer",
        "simpleValueType": true,
        "subParams": [
          {
            "type": "TEXT",
            "name": "heartbeatActiveTime",
            "displayName": "Active time (Optional)",
            "simpleValueType": true,
            "enablingConditions": [
              {
                "paramName": "enableHeartbeatTimer",
                "paramValue": true,
                "type": "EQUALS"
              }
            ],
            "valueValidators": [
              {
                "type": "POSITIVE_NUMBER"
              }
            ],
            "help": "Default is 15 seconds",
            "valueHint": "30",
            "valueUnit": "seconds"
          }
        ],
        "defaultValue": false,
        "help": "To accurately measure the time spent in the visit."
      },
      {
        "type": "CHECKBOX",
        "name": "enableLinkTracking",
        "checkboxText": "Enable Link Tracking",
        "simpleValueType": true,
        "defaultValue": false,
        "help": "Enables Download \u0026 Outlink tracking."
      },
      {
        "type": "CHECKBOX",
        "name": "enableJSErrorTracking",
        "checkboxText": "Enable JavaScript Errors Tracking",
        "simpleValueType": true,
        "defaultValue": false,
        "help": "Will send JavaScript errors as events in Matomo."
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const log = require('logToConsole');
const injectScript = require('injectScript');
const createQueue = require('createQueue');
const callLater = require('callLater');

function getPaq() {
  return createQueue("_paq");
}

function parseMatomoUrl() {
  if (data.matomoBaseUrl[data.matomoBaseUrl.length - 1] !== '/') {
    data.matomoBaseUrl+='/';
  }
}

var libraryUrl = "https://cdn.matomo.cloud/matomo.js";

const paq = getPaq();

if(data.setupType == "clientSide") {
  parseMatomoUrl();
  paq(['setTrackerUrl', data.matomoBaseUrl + 'matomo.php']);
  paq(['setSiteId', data.matomoSiteId]);
}

function paqPushCustomDimensions(paq)
{
  if (data.customDimensionsArray) {
    for (var i=0;i<data.customDimensionsArray.length;i++) {
      if(data.customDimensionsArray[i].customDimensionId) {
        paq(["setCustomDimension",data.customDimensionsArray[i].customDimensionId,data.customDimensionsArray[i].customDimensionValue]);
      }
    }
  }
}

function crossDomainLinking(paq) {
  if(data.enableCrossDomainTracking) {
    var domainNames = [];
    data.domainNames.forEach(function(domainName) {
      domainNames.push(domainName.domain_name);
    });
    
    paq(["setDomains", domainNames]);
    paq(["enableCrossDomainLinking"]);
    paq(["enableLinkTracking"]);
  }
}

crossDomainLinking(paq);
paqPushCustomDimensions(paq);

if(data.enableLinkTracking && !data.enableCrossDomainTracking) {
  paq(["enableLinkTracking"]);
}

if(data.userId) {
  paq(["setUserId", data.userId]);
}

if(data.overrideDocumentTitle) {
  paq(["setDocumentTitle", data.newDocumentTitle]);
}

if(data.overridePageUrl) {
  paq(["setCustomUrl", data.newPageUrl]);
}


if(data.enableHeartbeatTimer && !data.heartbeatActiveTime) {
  paq(["enableHeartBeatTimer"]);
} else if (data.enableHeartbeatTimer && data.heartbeatActiveTime) {
  paq(["enableHeartBeatTimer", data.heartbeatActiveTime]);
}

if(data.enableJSErrorTracking) {
  paq(["enableJSErrorTracking"]);
}

if(data.overridePageReferrer) {
  paq(["setReferrerUrl", data.newPageReferrer]);
}

if(data.contentSettings === "trackAllContentImpressions") {
   paq([data.contentSettings]);
} else if (data.contentSettings === "trackVisibleContentImpressions") {
  paq([data.contentSettings, !data.disableCheckOnScroll, data.timeInterval]);
}

if(data.delayPageView) {
  callLater(function(){
    paq(["trackPageView"]); 
  }, data.delayTime);
} else {
  paq(["trackPageView"]);
}

if(data.setupType == "clientSide") {
  injectScript(libraryUrl, data.gtmOnSuccess, data.gtmOnFailure);
} else {
  data.gtmOnSuccess();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_paq"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.matomo.cloud/matomo.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 01/01/2024, 10:04:40


